<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Portadas de Series</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f9ff;
      color: #333;
    }

    h2 {
      color: #1a73e8;
      margin-bottom: 20px;
      font-size: 24px;
      font-weight: 600;
      border-bottom: 2px solid #e0e9ff;
      padding-bottom: 8px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    table th {
      background-color: #1a73e8;
      color: white;
      font-weight: 600;
      padding: 12px 15px;
      text-align: left;
      
    }

    table td {
      border: 1px solid #e0e9ff;
      padding: 10px 15px;
      vertical-align: top;
    }

    tr:nth-child(even) {
      background-color: #f8fbff;
    }

    tr:hover {
      background-color: #e8f1ff;
    }

    select {
      padding: 10px 15px;
      border: 2px solid #d3e3fd;
      border-radius: 8px;
      font-size: 14px;
      background-color: #f8fbff;
      color: #333;
      min-width: 180px;
    }

    select:focus {
      border-color: #1a73e8;
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
      outline: none;
    }

    button {
      padding: 10px 20px;
      background-color: #1a73e8;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 2px 5px rgba(26, 115, 232, 0.2);
    }

    button:hover {
      background-color: #1557b0;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(26, 115, 232, 0.3);
    }

    button:active {
      transform: translateY(0);
    }

    .filtros-container {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-bottom: 20px;
      align-items: center;
      background-color: #f8fbff;
      padding: 15px;
      border-radius: 10px;
      border: 1px solid #e0e9ff;
    }

    #paginacion {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-top: 20px;
    }

    #paginacion span {
      font-weight: 500;
    }

    @media (max-width: 768px) {
      .filtros-container {
        flex-direction: column;
        align-items: flex-start;
      }

      select, button {
        width: 100%;
      }
    }
  </style>
</head>
<body>

  <h2>Listado de Portadas de Series</h2>

  <div class="filtros-container">
    <select id="filtroSerie"><option value="">Todas las series</option></select>
    <select id="filtroCategoria"><option value="">Todas las categor√≠as</option></select>
    <select id="filtroIdioma"><option value="">Todos los idiomas</option></select>
    <select id="filtroA√±o"><option value="">Todos los a√±os</option></select>
    <button onclick="aplicarFiltros()">Aplicar Filtros</button>
    <button onclick="resetearFiltros()">Resetear</button>
    <button onclick="exportarTablaAExcel()">üì• Exportar a Excel</button>
  </div>

  <table id="tablaSeries">
    <thead>
      <tr>
  <th>Serie</th>
  <th>Nombre Ingl√©s</th>
  <th>Nombre Japon√©s</th>
  <th>A√±o</th>
  <th>Categor√≠a</th>
  <th>Idioma</th>
  <th>Imagen</th>
  <th>Sitio</th>
</tr>

    </thead>
    <tbody></tbody>
  </table>

  <div id="paginacion"></div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB6MY2y5uyum87PdUHUpY8NNh4D73Yhx4U",
      authDomain: "animes-plus-89b93.firebaseapp.com",
      projectId: "animes-plus-89b93",
      storageBucket: "animes-plus-89b93.appspot.com",
      messagingSenderId: "402867181985",
      appId: "1:402867181985:web:d695b12977fe4270dbd3e0",
      measurementId: "G-DN632G7XJT"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let datosCargados = [];
    let datosFiltrados = [];
    let paginaActual = 1;
    const registrosPorPagina = 10;

    
    async function cargarDatos() {
  datosCargados = [];
  const snapshot = await db.collection("animes-series-indice").get();

  for (const doc of snapshot.docs) {
    const data = doc.data();

    datosCargados.push({
      nombreSerie: doc.id,
      nombresec: data.nombresec || "",
      nombresec02: data.nombresec02 || "",
      a√±o: data.a√±o || "",
      categoria: data.categoria || "",
      idioma: data.idioma || "",
      imagen: data.imagen || "",
      sitio: data.sitio || ""
    });
  }

  poblarFiltros();
  aplicarFiltros();
}

    function poblarFiltros() {
  const series = new Set();
  const categorias = new Set();
  const idiomas = new Set();
  const a√±os = new Set();

  datosCargados.forEach(d => {
    series.add(d.nombreSerie);
    categorias.add(d.categoria);
    idiomas.add(d.idioma);
    a√±os.add(d.a√±o);
  });

  llenarSelect("filtroSerie", Array.from(series));
  llenarSelect("filtroCategoria", Array.from(categorias));
  llenarSelect("filtroIdioma", Array.from(idiomas));
  llenarSelect("filtroA√±o", Array.from(a√±os));
}


    function llenarSelect(id, opciones) {
      const select = document.getElementById(id);
      const valorAnterior = select.value;
      select.innerHTML = `<option value="">Todos</option>`;
      opciones.sort().forEach(op => {
        select.innerHTML += `<option value="${op}">${op}</option>`;
      });
      select.value = valorAnterior;
    }

    function aplicarFiltros() {
  const serie = document.getElementById("filtroSerie").value;
  const categoria = document.getElementById("filtroCategoria").value;
  const idioma = document.getElementById("filtroIdioma").value;
  const a√±o = document.getElementById("filtroA√±o").value;

  datosFiltrados = datosCargados.filter(d =>
    (!serie || d.nombreSerie === serie) &&
    (!categoria || d.categoria === categoria) &&
    (!idioma || d.idioma === idioma) &&
    (!a√±o || d.a√±o == a√±o)
  );

  paginaActual = 1;
  mostrarPagina();
}


    function mostrarPagina() {
  const tbody = document.querySelector("#tablaSeries tbody");
  tbody.innerHTML = "";

  const inicio = (paginaActual - 1) * registrosPorPagina;
  const fin = inicio + registrosPorPagina;
  const pagina = datosFiltrados.slice(inicio, fin);

  pagina.forEach(d => {
    const fila = document.createElement("tr");
    fila.innerHTML = `
      <td>${d.nombreSerie}</td>
      <td style="word-break: break-word;">${escapeHTML(d.nombresec)}</td>
      <td style="word-break: break-word;">${escapeHTML(d.nombresec02)}</td>
      <td>${escapeHTML(d.a√±o)}</td>
      <td>${escapeHTML(d.categoria)}</td>
      <td>${escapeHTML(d.idioma)}</td>
      <td style="max-width: 300px; word-break: break-word;">
        ${d.imagen ? `<a href="${d.imagen}" target="_blank">${escapeHTML(d.imagen)}</a>` : ""}
      </td>
      <td style="max-width: 300px; word-break: break-word;">
        ${d.sitio ? `<a href="${d.sitio}" target="_blank">${escapeHTML(d.sitio)}</a>` : ""}
      </td>
    `;
    tbody.appendChild(fila);
  });

  renderizarPaginacion();
}


    function renderizarPaginacion() {
      const contenedor = document.getElementById("paginacion");
      contenedor.innerHTML = "";

      const totalPaginas = Math.ceil(datosFiltrados.length / registrosPorPagina);

      const btnAnterior = document.createElement("button");
      btnAnterior.textContent = "‚¨Ö Anterior";
      btnAnterior.disabled = paginaActual === 1;
      btnAnterior.onclick = () => {
        paginaActual--;
        mostrarPagina();
      };

      const btnSiguiente = document.createElement("button");
      btnSiguiente.textContent = "Siguiente ‚û°";
      btnSiguiente.disabled = paginaActual === totalPaginas || totalPaginas === 0;
      btnSiguiente.onclick = () => {
        paginaActual++;
        mostrarPagina();
      };

      const info = document.createElement("span");
      info.textContent = `P√°gina ${paginaActual} de ${totalPaginas || 1}`;

      contenedor.appendChild(btnAnterior);
      contenedor.appendChild(info);
      contenedor.appendChild(btnSiguiente);
    }

    function resetearFiltros() {
      document.getElementById("filtroSerie").value = "";
      document.getElementById("filtroCategoria").value = "";
      document.getElementById("filtroIdioma").value = "";
      document.getElementById("filtroA√±o").value = "";
      paginaActual = 1;
      aplicarFiltros();
    }

     function exportarTablaAExcel() {
  if (datosFiltrados.length === 0) {
    alert("No hay datos para exportar.");
    return;
  }

  // Convertir datos filtrados a formato de hoja de c√°lculo con los campos correctos
  const datosParaExportar = datosFiltrados.map(d => ({
    Serie: d.nombreSerie,
    "Nombre Ingl√©s": d.nombresec,
    "Nombre Japon√©s": d.nombresec02,
    A√±o: d.a√±o,
    Categor√≠a: d.categoria,
    Idioma: d.idioma,
    "Enlace Imagen": d.imagen,
    "Enlace Sitio": d.sitio
  }));

  const ws = XLSX.utils.json_to_sheet(datosParaExportar);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Series √çndice");

  XLSX.writeFile(wb, "series_indice_filtradas.xlsx");
}


    function escapeHTML(str) {
      return str.replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;");
    }

    window.onload = cargarDatos;
  </script>
</body>
</html>
